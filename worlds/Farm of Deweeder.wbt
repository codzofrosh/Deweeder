#VRML_SIM R2025a utf8

EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2025a/projects/robots/gctronic/e-puck/protos/E-puck.proto"

WorldInfo {
  basicTimeStep 64
}

Viewpoint {
  position 0.1 0 0.2
  orientation 1 0 0 -1.57
  follow "ROBOT_BASE"
}

DirectionalLight {
  direction 0 -1 -0.1
  intensity 4.0
  castShadows FALSE
}

Background {
  skyColor [0.7 0.9 1.0]
}

# Brown soil floor
Solid {
  translation 0 0 0
  name "floor"
  children [
    Shape {
      geometry Box { size 2 2 0.1 }
      appearance PBRAppearance {
        baseColor 0.8 0.6 0.3
        roughness 1.0
      }
    }
  ]
}

# Green crops
Solid {
  translation -0.6 0.8 0.08
  name "crop_1"
  children [
    Shape {
      geometry Box { size 0.1 0.1 0.15 }
      appearance PBRAppearance { 
        baseColor 0 1 0
      }
    }
  ]
}

Solid {
  translation -0.3 0.8 0.08
  name "crop_2"
  children [
    Shape {
      geometry Box { size 0.1 0.1 0.15 }
      appearance PBRAppearance { 
        baseColor 0 1 0
      }
    }
  ]
}

Solid {
  translation 0 0.8 0.08
  name "crop_3"
  children [
    Shape {
      geometry Box { size 0.1 0.1 0.15 }
      appearance PBRAppearance { 
        baseColor 0 1 0
      }
    }
  ]
}

Solid {
  translation 0.3 0.8 0.08
  name "crop_4"
  children [
    Shape {
      geometry Box { size 0.1 0.1 0.15 }
      appearance PBRAppearance { 
        baseColor 0 1 0
      }
    }
  ]
}

Solid {
  translation 0.6 0.8 0.08
  name "crop_5"
  children [
    Shape {
      geometry Box { size 0.1 0.1 0.15 }
      appearance PBRAppearance { 
        baseColor 0 1 0
      }
    }
  ]
}

# Red weeds - fewer but larger for easier targeting
# Realistic weed distribution - scattered randomly
Solid {
  translation 0.2 0.6 0.06   # Side of field
  name "weed_1"
  children [Shape {geometry Sphere { radius 0.06 } appearance PBRAppearance { baseColor 1 0 0 }}]
}

Solid {
  translation 0.5 -0.2 0.06  # Another area
  name "weed_2" 
  children [Shape {geometry Sphere { radius 0.06 } appearance PBRAppearance { baseColor 1 0 0 }}]
}

Solid {
  translation 0.8 0.3 0.06   # Different location
  name "weed_3"
  children [Shape {geometry Sphere { radius 0.06 } appearance PBRAppearance { baseColor 1 0 0 }}]
}

# Main robot base (E-puck) - using your existing controller
DEF ROBOT_BASE E-puck {
  translation -0.8 0 0.06
  rotation 0 0 1 1.57
  controller "my_controller"  # Pointing to your existing controller
}

# Robotic Arm for De-weeding
DEF DEWEEDER_ARM Robot {
  translation -0.65 0 0.08  # Positioned on front of E-puck
  rotation 0 0 1 1.57
  children [
    # Arm Base
    Transform {
      translation 0.03 0 0
      children [
        DEF ARM_BASE Shape {
          geometry Cylinder {
            height 0.03
            radius 0.015
          }
          appearance PBRAppearance {
            baseColor 0.3 0.3 0.3
          }
        }
      ]
    }
    
    # First Arm Segment (Shoulder Joint)
    HingeJoint {
      jointParameters HingeJointParameters {
        anchor 0.05 0 0.015
      }
      device [
        RotationalMotor {
          name "shoulder_motor"
          maxTorque 10
        }
      ]
      endPoint Solid {
        translation 0.05 0 0.015
        children [
          DEF ARM_SEGMENT_1 Shape {
            geometry Box {
              size 0.08 0.02 0.02
            }
            appearance PBRAppearance {
              baseColor 0.5 0.5 0.5
            }
          }
          Transform {
            translation 0.04 0 0
            children [
              # Second Arm Segment (Elbow Joint)
              HingeJoint {
                jointParameters HingeJointParameters {
                  anchor 0 0 0
                }
                device [
                  RotationalMotor {
                    name "elbow_motor"
                    maxTorque 10
                  }
                ]
                endPoint Solid {
                  translation 0 0 0
                  children [
                    DEF ARM_SEGMENT_2 Shape {
                      geometry Box {
                        size 0.06 0.015 0.015
                      }
                      appearance PBRAppearance {
                        baseColor 0.7 0.7 0.7
                      }
                    }
                    Transform {
                      translation 0.03 0 0
                      children [
                        # End Effector (Sprayer)
                        Shape {
                          geometry Sphere {
                            radius 0.01
                          }
                          appearance PBRAppearance {
                            baseColor 1 0 0
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    }
  ]
  controller "my_controller"
}